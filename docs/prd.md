# BIM 项目管理系统 - 产品需求文档 (PRD)

## 版本历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|----------|
| v1.0.0 | 2025-01-09 | - | 初始版本：基础项目台账管理功能 |
| v1.1.0 | 2025-01-10 | - | 新增用户管理、部门管理功能 |
| v1.2.0 | 2026-01-12 | - | 新增项目台账Excel导出功能 |
| v1.2.1 | 2026-01-12 | - | 新增工作分解和任务管理功能 |
| v1.2.2 | 2026-01-13 | - | 优化工作分解UI：横向思维导图视图 + 高密度项目列表 |
| v1.3.0 | 2026-01-14 | - | 工作台UI全面重构：三栏布局设计 |

---

## v1.3.0 - 工作台UI全面重构：三栏布局设计

### 功能概述

根据用户反馈，对现有工作台界面进行全面UI重构，实现专业级三栏布局的任务管理工作台：

1. **三栏布局结构**：左侧导航栏(200px) + 中间主内容区(自适应) + 右侧信息栏(280px)
2. **项目头部卡片**：显示项目标题、进度阶段、进度条等关键信息
3. **统计卡片区域**：3个渐变背景卡片（建筑面积、总工期、合同额）
4. **我的待办卡片**：4个待办项（任务、预警、紧急、逾期）
5. **待办列表表格**：详细的待办任务列表，支持查看和办理
6. **团队工作统计图表**：双Y轴图表（工作项数柱状图 + 工时折线图）
7. **天气卡片**：显示当前天气和未来预报
8. **任务完成环形图**：可视化展示任务完成情况
9. **常用功能卡片**：2x2网格快捷按钮
10. **OKR指标进度卡片**：显示OKR任务完成指标

### 功能原型

#### 整体布局（三栏结构）

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    顶部导航栏 (与App.tsx保持一致)                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────┬───────────────────────────────────────────────────────────────┬─────────────────┐
│              │                                                               │                 │
│   左侧导航栏  │                    中间主内容区                                │   右侧信息栏    │
│    (200px)   │                      (自适应宽度)                               │    (280px)      │
│              │                                                               │                 │
│ ┌──────────┐ │ ┌───────────────────────────────────────────────────────────┐ │ ┌─────────────┐ │
│ │ LOGO区域 │ │ │ 【项目头部卡片】                                            │ │ │ 【天气卡片】 │ │
│ │ 40px高   │ │ │ ├─ 项目标题: "XXXXXX绿色XX项目"                            │ │ │             │ │
│ └──────────┘ │ │ ├─ 项目进度: [安装阶段] [查看计划 >] 进度: 68%                │ │ │ ☀️ 26℃      │ │
│              │ │ └─ 进度条: ████████░░░░ 68%                                │ │ │ 20-28℃ 晴  │ │
│ ┌──────────┐ │ └───────────────────────────────────────────────────────────┘ │ └─────────────┘ │
│ │主导航    │ │                                                               │                 │
│ ├──────────┤ │ ┌───────────────────────────────────────────────────────────┐ │ ┌─────────────┐ │
│ │📋 项目台账│ │ │ 【统计卡片区域】(3个横向卡片，渐变背景)                   │ │ │【任务完成】  │ │
│ │🏠 工作台  │ │ │ ┌──────────┬──────────┬──────────┐                       │ │ │   ○  46%    │ │
│ │📄 工作分解│ │ │ ││3,280㎡  ││ 809天   ││6,300万元│                       │ │ │ ● 已完成8   │ │
│ │📅 周报    │ │ │ └──────────┴──────────┴──────────┘                       │ │ │ ● 进行中6   │ │
│ └──────────┘ │ └───────────────────────────────────────────────────────────┘ │ │ ● 已逾期2   │ │
│              │                                                               │ │ └─────────────┘ │
│ ┌──────────┐ │ ┌───────────────────────────────────────────────────────────┐ │                 │
│ │系统管理  │ │ │ 【我的待办卡片】(4个待办项，蓝色圆形图标背景)               │ │ ┌─────────────┐ │
│ │(仅管理员)│ │ │ │ ┌────────┬────────┬────────┬────────┐                 │ │ │【常用功能】  │ │
│ └──────────┘ │ │ │ │ 任务10 │ 预警3 │ 紧急2 │ 逾期0 │                 │ │ │ ┌───┬───┐   │ │
│              │ │ │ └────────┴────────┴────────┴────────┘                 │ │ │ │我的│新建│   │ │
│ ┌──────────┐ │ │ └───────────────────────────────────────────────────────────┘ │ │ │工作│任务│   │ │
│ │用户信息区 │ │                                                               │ │ │ ├───┼───┤   │ │
│ │头像+名字  │ │ │ ┌───────────────────────────────────────────────────────────┐ │ │ │数据│新建│   │ │
│ │退出按钮  │ │ │ │ 【待办列表卡片】(表格：任务名称|类型|时间|发起人|状态|操作)   │ │ │ │大屏│会议│   │ │
│ └──────────┘ │ │ │ ┌─────────────────────────────────────────────────────────┐ │ │ │ └───┴───┘   │ │
│              │ │ │ │ 任务1    │ 类型A   │ 08/24   │ 张三  │[正常]│办理    │ │ │ └─────────────┘ │
│   (固定)     │ │ │ │ ────────────────────────────────────────────────── │ │ │                 │
│              │ │ │ └─────────────────────────────────────────────────────────┘ │ │ ┌─────────────┐ │
│              │ │ │                                                               │ │ │【OKR指标】  │ │
│              │ │ │ ┌───────────────────────────────────────────────────┐ │ │ │ 鲁班奖      │ │
│              │ │ │ │ 【团队工作统计图表】(双Y轴:柱状图+折线图)         │ │ │ │ ████████ 60%│ │
│              │ │ │ │ 25│  ███  ████  █████  ███  ████                 │ │ │ │ 优秀奖      │ │
│              │ │ │ │ 20│  ███  ████  █████  ███  ████  ───●────      │ │ │ │ ████████ 80%│ │
│              │ │ │ │ 15│  ███  ████  █████  ███  ████                 │ │ │ └─────────────┘ │
│              │ │ │ │ 10│  ███  ████  █████  ███  ████                 │ │ │                 │
│              │ │ │ │  5└─────────────────────────────────────────────  │ │                 │
│              │ │ │ │    张三   李四   王五   赵六   钱七   孙八         │ │                 │
│              │ │ │ └───────────────────────────────────────────┘ │ │                 │
│              │ │ │                                                           │ │                 │
└──────────────┴───────────────────────────────────────────────────────────────┴─────────────────┘
```

### 技术架构

#### 组件结构

```
Workbench.tsx (主布局容器 - 完全重构)
├── 三栏CSS Grid布局
│   ├── 左侧导航栏(从App.tsx复用样式)
│   ├── 中间主内容区
│   └── 右侧信息栏
│
├── 中间内容区组件
│   ├── ProjectHeaderCard (项目头部卡片)
│   ├── StatsCards (统计卡片区域 - 3个渐变卡片)
│   ├── MyTodosCard (我的待办 - 4个待办项)
│   ├── TodoListCard (待办列表表格)
│   └── TeamStatsChart (团队工作统计图表)
│
└── 右侧信息栏组件
    ├── WeatherCard (天气卡片)
    ├── TaskCompletionCard (任务完成环形图)
    ├── QuickFunctionsCard (常用功能 - 2x2按钮)
    └── OkrMetricsCard (OKR指标进度条)
```

#### 技术要点

**1. 三栏CSS Grid布局**

```tsx
/* Workbench.css - 全新的三栏布局 */
.workbench-layout {
  display: grid;
  grid-template-columns: 200px 1fr 280px;
  gap: 16px;
  min-height: 100vh;
  background: #F5F7FA;
}

@media (max-width: 1439px) {
  .workbench-layout {
    grid-template-columns: 200px 1fr;
  }
  .right-sidebar {
    display: none;
  }
}

@media (max-width: 1023px) {
  .workbench-layout {
    grid-template-columns: 1fr;
  }
  .left-sidebar {
    display: none;
  }
}
```

**2. 项目头部卡片**

```tsx
// components/workbench/ProjectHeaderCard.tsx
interface ProjectHeaderCardProps {
  projectName: string;
  projectStage: string;
  startDate: string;
  endDate: string;
  progress: number;
}

// 显示项目标题、进度阶段标签、日期范围、进度百分比和进度条
```

**3. 统计卡片区域（渐变背景）**

```tsx
// components/workbench/StatsCards.tsx
// 3个横向排列的卡片
// 卡片1：总建筑面积 - 蓝色渐变背景 (#DBEAFE → #BFDBFE)
// 卡片2：总工期 - 绿色渐变背景 (#D1FAE5 → #A7F3D0)
// 卡片3：合同额 - 红色渐变背景 (#FEE2E2 → #FECACA)
```

**4. 我的待办卡片**

```tsx
// components/workbench/MyTodosCard.tsx
// 4个待办项横向排列，每项25%宽度
// 任务10 | 预警3 | 紧急2 | 逾期0
// 蓝色圆形图标背景（48x48px）
```

**5. 待办列表表格**

```tsx
// components/workbench/TodoListCard.tsx
// 使用Ant Design Table
// 列：任务名称 | 任务类型 | 办结时间 | 发起人 | 状态 | 操作
// 状态标签：正常(绿色)、紧急(红色)
```

**6. 团队工作统计图表（双Y轴）**

```tsx
// components/workbench/TeamStatsChart.tsx
// 使用ECharts实现
// 左Y轴：工作项数（柱状图，蓝色 #3B82F6）
// 右Y轴：工时（折线图，绿色 #10B981）
// X轴：人员名称
```

**7. 天气卡片**

```tsx
// components/workbench/WeatherCard.tsx
// 当前天气区域：
//   - 太阳图标（64x64px，渐变黄色）
//   - 温度显示（26℃）
//   - 温度范围（20-28℃）
//   - 天气描述（晴转多云）
//   - 日期时间
// 未来天气预报：
//   - 今天、明天两列
//   - 显示温度、空气质量、风向
```

**8. 任务完成环形图**

```tsx
// components/workbench/TaskCompletionCard.tsx
// 使用ECharts实现
// 颜色分段：
//   - 已完成（蓝色）：#3B82F6
//   - 进行中（紫色）：#8B5CF6
//   - 已逾期（橙色）：#F59E0B
//   - 未开始（绿色）：#10B981
// 中心文字：46% 任务完成率
```

**9. 常用功能卡片**

```tsx
// components/workbench/QuickFunctionsCard.tsx
// 2x2网格布局
// 4个按钮：
//   - 我的工作（蓝色）
//   - 新建任务（绿色）
//   - 数据大屏（橙色）
//   - 新建会议（蓝色）
```

**10. OKR指标进度卡片**

```tsx
// components/workbench/OkrMetricsCard.tsx
// 5个指标项，垂直排列
// 每项包含：
//   - 指标名称
//   - 标签（实际/目标/完成）
//   - 进度条
```

### 设计规范

#### 颜色系统

```css
/* 工作台专用颜色系统 */
--wb-primary: #3B82F6;        /* 主蓝色 */
--wb-success: #10B981;        /* 成功/正常 */
--wb-warning: #F59E0B;        /* 警告/紧急 */
--wb-danger: #EF4444;         /* 危险/逾期 */
--wb-bg-page: #F5F7FA;        /* 页面背景 */
--wb-bg-card: #FFFFFF;        /* 卡片背景 */

/* 渐变背景 */
--wb-gradient-blue: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
--wb-gradient-green: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
--wb-gradient-red: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
```

#### 间距系统

```css
/* 基于4px基准单位 */
--wb-spacing-xs: 4px;
--wb-spacing-sm: 8px;
--wb-spacing-md: 12px;
--wb-spacing-lg: 16px;
--wb-spacing-xl: 20px;
--wb-spacing-2xl: 24px;
```

#### 卡片样式

```css
.wb-card {
  background: #FFFFFF;
  border-radius: 8px;
  padding: 20px 24px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}
```

### 数据流设计

```
用户打开工作台页面
  ↓
并行发起多个数据请求：
  ├─ 获取项目头部信息（项目名称、进度、日期）
  ├─ 获取统计数据（建筑面积、工期、合同额）
  ├─ 获取我的待办统计（任务、预警、紧急、逾期）
  ├─ 获取待办列表
  ├─ 获取团队工作统计（工作项数+工时）
  ├─ 获取天气数据（API或Mock）
  ├─ 获取任务完成情况
  └─ 获取OKR指标
  ↓
数据返回后渲染各组件
  ↓
用户交互：
  ├─ 点击"办理"按钮 → 打开任务详情弹窗
  ├─ 点击常用功能按钮 → 跳转对应页面
  ├─ 切换时间筛选器 → 重新获取团队统计数据
  └─ ...
```

### 文件变更清单

**修改文件（前端）**：
- `frontend/src/pages/Workbench.tsx` - 完全重构为三栏布局
- `frontend/src/pages/Workbench.css` - 重写样式
- `frontend/src/hooks/useTasks.ts` - 添加团队统计hook
- `frontend/src/services/api.ts` - 添加天气、团队统计API
- `frontend/src/types/tasks.ts` - 扩展团队统计类型

**新增文件（前端）**：
- `frontend/src/components/workbench/ProjectHeaderCard.tsx`
- `frontend/src/components/workbench/StatsCards.tsx`
- `frontend/src/components/workbench/MyTodosCard.tsx`
- `frontend/src/components/workbench/TodoListCard.tsx`
- `frontend/src/components/workbench/TeamStatsChart.tsx`
- `frontend/src/components/workbench/WeatherCard.tsx`
- `frontend/src/components/workbench/TaskCompletionCard.tsx`
- `frontend/src/components/workbench/QuickFunctionsCard.tsx`
- `frontend/src/components/workbench/OkrMetricsCard.tsx`
- `frontend/src/components/workbench/index.ts`
- `frontend/src/hooks/useWeather.ts`
- `frontend/src/types/weather.ts`
- `frontend/src/utils/chartUtils.ts`

**新增文件（后端 - 可选）**：
- `backend/src/routes/weatherRoutes.ts`
- `backend/src/controllers/weatherController.ts`

**依赖安装**：
```bash
npm install echarts echarts-for-react
```

### 兼容性保证

**不影响其他模块的措施：**
1. ✅ 仅重构 `Workbench.tsx` 和 `Workbench.css`
2. ✅ 新组件放在独立的 `components/workbench/` 目录
3. ✅ 使用独立的CSS类名前缀 `.wb-`
4. ✅ 不修改路由配置 (`App.tsx`)
5. ✅ 不修改项目台账页面 (`ProjectLedger.tsx`)
6. ✅ 不修改工作分解页面 (`WorkBreakdown.tsx`)
7. ✅ 不修改用户管理页面 (`UserManagement.tsx`)
8. ✅ 扩展现有hooks和API服务，不修改已有方法

**回滚方案：**
- 使用Git分支管理
- 每个阶段完成后提交代码
- 如有问题可快速回滚到上一个稳定版本

### 验收标准

**功能测试：**
1. ✅ 三栏布局正确显示（左200px + 中自适应 + 右280px）
2. ✅ 响应式断点切换正常（1439px、1023px）
3. ✅ 项目头部卡片数据正确显示
4. ✅ 3个统计卡片显示正确，渐变背景正常
5. ✅ 我的待办4项显示正确
6. ✅ 待办列表表格数据正确
7. ✅ 团队统计图表渲染正确（双Y轴）
8. ✅ 天气卡片显示正常（或Mock数据）
9. ✅ 任务完成环形图正确
10. ✅ 常用功能按钮可点击
11. ✅ OKR指标进度条正确

**兼容性测试：**
1. ✅ 项目台账页面正常访问
2. ✅ 工作分解页面正常访问
3. ✅ 用户管理页面正常访问
4. ✅ 路由跳转正常
5. ✅ 页面刷新后功能正常

**视觉测试：**
1. ✅ 卡片圆角8px
2. ✅ 阴影0 1px 3px rgba(0,0,0,0.06)
3. ✅ 渐变背景正确
4. ✅ 图表动画流畅
5. ✅ hover效果正常
6. ✅ 整体风格统一

---

## v1.2.2 - 工作分解结构UI优化

### 功能概述

对工作分解结构页面进行全面UI优化，提升用户体验和信息密度：
1. **横向思维导图视图**：采用从左到右的树形布局，更符合宽屏显示和阅读习惯
2. **高密度项目列表**：优化左侧项目卡片设计，提升信息层次感和空间利用率
3. **视图切换功能**：预留思维导图/表格视图切换能力（表格视图后续开发）
4. **视觉优化**：统一设计风格，提升整体美观度

### 功能原型

#### 整体布局

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  ◀ 工作分解结构                            视图: [思维导图 ⚪] [表格 ◯]                                   │
├──────────────────┬──────────────────────────────────────────────────────────────────────────────────┤
│                  │  📊 XX大厦BIM项目 - 任务分解 (思维导图视图)                                        │
│  📁 项目列表     │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│    (240px)       │  [+ 新建根任务] [▶ 全部展开] [◀ 全部折叠] [🔍 搜索...] [💾 导出] [⚙️ 设置]            │
│                  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│ ┌──────────────┐ │                                                                                   │
│ │🔍 [________] │ │  画布区域（可拖拽、缩放、平移）                                                          │
│ └──────────────┘ │                                                                                   │
│                  │    ┌─────────────────────────┐                                                    │
│ ┌──────────────┐ │    │ XX大厦BIM项目整体实施     │                                                    │
│ │┏━━━━━━━━━━━┓│ │    │ ━━━━━━━━━━━━━━━━━━━━  │                                                    │
│ │┃XX大厦     ┃│ │    │ 🔄 65%  ⏱ 2000h  💰 2020万│                                                    │
│ │┃ ████████ ┃│ │    │ 👤 王工  📅 2024-01 ~ 12   │                                                    │
│ │┗━━━━━━━━━━━┛│ │    │ [编辑][删除][➕子任务]    │───────────┬───────────────────────────────┐    │
│ │ 65%  [编辑] │ │    └─────────────────────────┘           │                               │    │
│ │              │ │              │                             ▼                               ▼    │
│ │ 📋 18任务    │ │              ▼                    ┌─────────────────────┐   ┌─────────────────────┐  │
│ │ 🔄 6进行中   │ │    ┌─────────────────────┐        │ 前期准备阶段          │   │ 施工阶段              │  │
│ │ 👤 王工      │ │    │ 施工阶段              │        │ ━━━━━━━━━━━━━━━━  │   │ ━━━━━━━━━━━━━━━━  │  │
│ │ 📅 2024-12  │ │    │ ━━━━━━━━━━━━━━━━━━  │        │ ✅ 100%  ⏱ 320h      │   │ 🔄 45%  ⏱ 1200h      │  │
│ │ 💰 2020万   │ │    │ 🔄 45%  ⏱ 1200h       │        │ 👤 主工  Q1完成      │   │ 👤 建筑队长 Q2-Q4    │  │
│ │ ⏱ 2000h     │ │    │ 👤 建筑队长 Q2-Q4     │        │ [编辑][删除][➕]     │   │ [编辑][删除][➕子任务]│  │
│ └──────────────┘ │    │ [编辑][删除][➕子任务] │        └─────────────────────┘   └─────────────────────┘  │
│                  │    └─────────────────────┘              │         │                          │    │
│ ┌──────────────┐ │                                       ▼         ▼                          ▼    ▼    │
│ │┏━━━━━━━━━━━┓│ │                          ┌─────────┐  ┌─────────┐           ┌─────────┐  ┌─────────┐  │
│ │┃住宅小区   ┃│ │                          │ 需求分析 │  │ 方案设计 │           │ 基础建设 │  │ 主体施工 │  │
│ │┃ ████████ ┃│ │                          │ ✅ 100%│  │ ✅ 100%│           │ 🔄 60%  │  │ ⏳ 0%   │  │
│ │┗━━━━━━━━━━━┛│ │                          │ 80h    │  │ 120h   │           │ 200h    │  │ 500h    │  │
│ │ 45%  [编辑] │ │                          │[编辑➕]│  │[编辑➕]│           │[编辑➕]│  │[edit➕]│  │
│ │              │ │                          └─────────┘  └─────────┘           └─────────┘  └─────────┘  │
│ │ 📋 12任务    │ │                                                                                         │
│ │ ✅ 5完成     │ │  💡 操作提示: 拖拽节点调整位置 │ 滚轮缩放 │ 点击节点编辑 │ 双击展开/折叠                      │
│ │ 👤 建筑队长  │ │                                                                                         │
│ │ 📅 2024-06  │ │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│ │ 💰 500万    │ │  📊 任务统计: 总任务18 │ 进行中6 │ 已完成12 │ 未开始0 │ 完成率 67%                         │
│ │ ⏱ 800h      │ │                                                                                         │
│ └──────────────┘ │                                                                                         │
│                  │                                                                                         │
│ ┌──────────────┐ │                                                                                         │
│ │┏━━━━━━━━━━━┓│ │                                                                                         │
│ │┃商业综合体 ┃│ │                                                                                         │
│ │┃ ████████ ┃│ │                                                                                         │
│ │┗━━━━━━━━━━━┛│ │                                                                                         │
│ │ 80%  [编辑] │ │                                                                                         │
│ │              │ │                                                                                         │
│ │ 📋 8任务     │ │                                                                                         │
│ │ 🔄 3进行中  │ │                                                                                         │
│ │ 👤 项目经理  │ │                                                                                         │
│ │ 📅 2024-09  │ │                                                                                         │
│ │ 💰 1500万   │ │                                                                                         │
│ │ ⏱ 1500h     │ │                                                                                         │
│ └──────────────┘ │                                                                                         │
│                  │                                                                                         │
│  [➕ 新建项目]    │                                                                                         │
└──────────────────┴───────────────────────────────────────────────────────────────────────────────────┘
```

#### 左侧项目列表（高密度设计）

```
┌──────────────────────────────┐
│  📁 项目列表           (3)  │  ← 标题栏 + 计数
├──────────────────────────────┤
│  🔍 [________________]  ⚙️   │  ← 搜索框 + 设置
├──────────────────────────────┤
│                              │
│  ┌────────────────────────┐ │
│  │ 🏗️ XX大厦BIM项目      │ │  ← 项目类型图标 + 名称
│  │ ━━━━━━━━━━━━━━━━━━━━  │ │  ← 分隔线
│  │ ████████████░░ 65%    │ │  ← 进度条（紧凑 4px）
│  │                        │ │
│  │ 📋 18任务  🔄 6进行中 │ │  ← 任务统计（横向紧凑）
│  │ 👤 王工   📅 2024-12  │ │  ← 负责人 + 截止日期
│  │ 💰 2020万  ⏱ 2000h   │ │  ← 预算 + 工时
│  │                        │ │
│  │ [编辑] [删除] [展开▶]  │ │  ← 操作按钮
│  └────────────────────────┘ │
│                              │
│  ┌────────────────────────┐ │  ← 折叠状态示例
│  │ 🌳 住宅小区景观        │ │
│  │ ████████░░░░░░ 45%    │ │
│  │ 📋 12任务  ✅ 5完成   │ │
│  │ 👤 建筑队长 📅 2024-06 │ │
│  │ 💰 500万   ⏱ 800h    │ │
│  │ [编辑] [删除] [展开▶]  │ │
│  └────────────────────────┘ │
│                              │
│  [➕ 新建项目]               │
│                              │
└──────────────────────────────┘
     ↑         ↑
   240px    可滚动
```

#### 项目卡片展开状态

```
┌────────────────────────────────────────────────────────────────────┐
│  🏗️ XX大厦BIM项目                            [编辑] [删除] [◀ 折叠] │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                    │
│  📋 项目类型: 建筑设计    📅 周期: 2024-01-01 ~ 2024-12-31        │
│  👤 项目经理: 王工        💰 预算: 2020万元                         │
│  ⏱ 预计工时: 2000小时    🎯 当前进度: 65%                         │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ 📊 任务统计                                                  │ │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │ │
│  │  总任务: 18   │  进行中: 6   │  已完成: 12   │  未开始: 0    │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│  📅 重要节点:                                                      │
│  • 2024-03-31 前期准备阶段完成 ✅                                  │
│  • 2024-06-30 方案设计阶段完成 ✅                                  │
│  • 2024-10-31 施工阶段完成 🔄 (进行中)                             │
│                                                                    │
│  📝 备注: 该项目为BIM技术示范工程，需重点关注施工阶段的协同管理    │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

#### 思维导图节点（横向展开）

```
┌─────────────────────────┐
│ XX大厦BIM项目整体实施     │ ← 根任务 (200×140px)
│ ━━━━━━━━━━━━━━━━━━━━  │
│ 🔄 65%  ⏱ 2000h  💰 2020万│
│ 👤 王工  📅 2024-01 ~ 12   │
│ [编辑][删除][➕子任务]    │
└─────────────────────────┘
         │
    ┌────┴────┬────────────┐
    ▼         ▼            ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│前期准备  │ │施工阶段  │ │验收交付  │ ← 子任务 (180×100px)
│✅ 100%  │ │🔄 45%  │ │⏳ 0%   │
│320h     │ │1200h    │ │400h     │
└─────────┘ └─────────┘ └─────────┘
    │         │
    ▼         ▼
┌───────┐ ┌───────┐
│需求分析│ │方案设计│ ← 孙任务 (160×85px)
│ ✅100%│ │ ✅100%│
│ 80h   │ │ 120h  │
└───────┘ └───────┘
```

### 技术架构

#### 组件结构

```
WorkBreakdown.tsx (唯一修改文件)
├── WorkBreakdownHeader (顶部导航 + 视图切换)
├── SplitPane (左右分栏)
│   ├── ProjectSidebar (左侧项目列表) ← 新增
│   │   ├── ProjectSearch (搜索框)
│   │   ├── ProjectList (项目列表)
│   │   └── ProjectCard (项目卡片) ← 优化
│   │       ├── ProjectCardSummary (折叠状态) ← 新增
│   │       └── ProjectCardDetail (展开状态) ← 新增
│   └── TaskViewArea (右侧任务视图区域)
│       ├── TaskViewHeader (操作栏 + 视图切换)
│       ├── MindmapView (思维导图视图 - 默认) ← 新增
│       │   └── MindmapCanvas (SVG画布)
│       │       └── MindmapNode (任务节点)
│       └── TableView (表格视图 - 占位) ← 预留
└── TaskModal (任务表单弹窗)
```

#### 技术要点

**1. 左侧项目列表优化**

```tsx
// 项目卡片 - 折叠状态（高密度）
<ProjectCardSummary>
  - 项目类型图标 + 名称
  - 紧凑进度条（4px高）
  - 任务统计（一行横向显示）
  - 负责人 + 截止日期（一行横向显示）
  - 预算 + 工时（一行横向显示）
  - 操作按钮（编辑/删除/展开）
</ProjectCardSummary>

// 项目卡片 - 展开状态（详细信息）
<ProjectCardDetail>
  - 项目类型 + 名称（可折叠）
  - 项目详细信息（周期、负责人、预算、工时）
  - 任务统计卡片
  - 重要节点时间线
  - 备注
</ProjectCardDetail>
```

**2. 思维导图视图（横向布局）**

```tsx
// 使用自定义SVG实现横向树形布局
const MindmapView: React.FC = () => {
  // 将任务树转换为横向节点位置
  const buildHorizontalLayout = (tasks: Task[]) => {
    // 计算每个节点的 x, y 坐标
    // 根节点在左侧，子节点向右扩展
  };

  return (
    <svg>
      {/* 贝塞尔曲线连接线 */}
      {edges.map(edge => (
        <path d={`M ${x1} ${y1} C ${x1+50} ${y1}, ${x2-50} ${y2}, ${x2} ${y2}`} />
      ))}

      {/* 节点使用foreignObject */}
      {nodes.map(node => (
        <foreignObject x={node.x} y={node.y} width={180} height={100}>
          <MindmapNode task={node.task} />
        </foreignObject>
      ))}
    </svg>
  );
};
```

**3. 视图切换状态管理**

```tsx
const [viewMode, setViewMode] = useState<'mindmap' | 'table'>('mindmap');

// 视图切换按钮
<Segmented
  options={[
    { label: '思维导图', value: 'mindmap', icon: <ApartmentOutlined /> },
    { label: '表格视图', value: 'table', icon: <TableOutlined /> },
  ]}
  value={viewMode}
  onChange={setViewMode}
/>

// 条件渲染
{viewMode === 'mindmap' ? <MindmapView /> : <TableView />}
```

**4. CSS 样式规范**

```css
/* 组件前缀：.wb- (WorkBreakdown) */

/* 左侧项目列表 */
.wb-sidebar {
  width: 240px;
  background: #fff;
  border-right: 1px solid #e5e7eb;
}

.wb-project-card {
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  margin-bottom: 8px;
  transition: all 0.2s;
}

.wb-project-card:hover {
  border-color: #3b82f6;
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
}

/* 思维导图节点 */
.wb-mindmap-node {
  width: 180px;
  min-height: 100px;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: all 0.2s;
}

.wb-mindmap-node:hover {
  border-color: #3b82f6;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
  transform: translateY(-2px);
}
```

### 数据流设计

```
用户操作 → 组件状态变更 → API 调用 → 数据更新 → UI 渲染

1. 点击项目卡片"展开"按钮
   → setProjectExpanded(projectId, true)
   → 重新渲染项目卡片（显示详细信息）

2. 点击思维导图节点
   → handleNodeClick(taskId)
   → 打开任务详情弹窗

3. 拖拽思维导图节点
   → onNodeDrag(event, node)
   → 更新节点位置状态
   → 可选：调用 API 保存位置

4. 切换视图模式
   → setViewMode('table')
   → 渲染表格视图组件
```

### 兼容性保证

**不影响其他模块的措施：**
1. ✅ 仅修改 `WorkBreakdown.tsx` 文件
2. ✅ 使用独立的 CSS 类名前缀 `.wb-`
3. ✅ 不修改路由配置 (`App.tsx`)
4. ✅ 不修改项目台账页面 (`ProjectLedger.tsx`)
5. ✅ 不修改工作台页面 (`Workbench.tsx`)
6. ✅ 不修改用户管理页面 (`UserManagement.tsx`)
7. ✅ 不修改共享组件和 hooks
8. ✅ 不修改 API 服务层

**回滚方案：**
- 使用 Git 分支管理
- 每个阶段完成后提交代码
- 如有问题可快速回滚到上一个稳定版本

### 验收标准

**功能测试：**
1. ✅ 项目列表正常显示（折叠/展开状态切换正常）
2. ✅ 思维导图视图正常渲染（横向从左到右布局）
3. ✅ 任务节点可点击、编辑、删除
4. ✅ 可创建根任务和子任务
5. ✅ 展开/折叠功能正常
6. ✅ 视图切换按钮显示正常（表格视图预留）

**视觉测试：**
1. ✅ 项目卡片信息层次清晰
2. ✅ 思维导图连接线流畅
3. ✅ 节点间距合理
4. ✅ 悬停效果正常
5. ✅ 整体风格统一

**兼容性测试：**
1. ✅ 项目台账页面正常访问
2. ✅ 工作台页面正常访问
3. ✅ 用户管理页面正常访问
4. ✅ 页面刷新后功能正常

---

## v1.2.1 - 工作分解与任务管理功能

### 功能概述

为系统添加工作分解（WBS）和任务管理功能：
1. **工作分解模块**：支持对项目进行任务树形分解，创建多层级任务结构
2. **任务分配**：将任务分配给相关项目负责人和员工
3. **工作台模块**：员工可以查看自己被分配的任务，更新任务进度

### 功能原型

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           BIM项目管理系统 - 工作分解                          │
├──────────────┬──────────────────────────────────────────────────────────────┤
│              │  首页 > 工作分解                                              │
│  ┌────────┐  ├──────────────────────────────────────────────────────────────┤
│  │ ☰ 菜单 │  │  项目选择                                                     │
│  ├────────┤  │  [选择项目▼] 选择要进行工作分解的项目                          │
│  │        │  ├──────────────────────────────────────────────────────────────┤
│  │ 项目台账│  │  [+ 新建根任务] [展开全部] [折叠全部]                          │
│  │ 工作台  │  │                                                              │
│  │工作分解◄│  │  ┌───────────────────────────────────────────────────────┐   │
│  │ 周报管理│  │  │ 工作分解结构树 (WBS)                                    │   │
│  │        │  │  │                                                         │   │
│  │        │  │  │  📁 XX大厦BIM项目 (100%)                                 │   │
│  │        │  │  │    ├── 📁 前期准备 (100%)                                │   │
│  │        │  │  │    │   ├── ✅ 现场勘察 (已完成) - 王工     [编辑][删除]  │   │
│  │        │  │  │    │   └── ✅ 方案设计 (已完成) - 李工     [编辑][删除]  │   │
│  │        │  │  │    └── 📁 施工阶段 (60%)                                 │   │
│  │        │  │  │        ├── 🔄 主体施工 (进行中) - 王工    [编辑][删除]  │   │
│  │        │  │  │        ├── ⏳ 装修工程 (未开始) - 刘工    [编辑][删除]  │   │
│  │        │  │  │        └── ➕ 添加子任务                                 │   │
│  └────────┘  │  │                                                         │   │
│              │  └───────────────────────────────────────────────────────┘   │
│              │                                                              │
│              │  点击任务后在右侧显示详情面板...                                │
└──────────────┴──────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────────┐
                    │   新建/编辑任务弹窗              │
                    ├─────────────────────────────────┤
                    │                                 │
                    │  任务名称: [_________________]   │
                    │  任务描述:                       │
                    │  [_________________________]   │
                    │                                 │
                    │  父任务: [施工阶段 ▼]            │
                    │  负责人: [选择人员 ▼]           │
                    │  开始日期: [2026-01-15 📅]      │
                    │  结束日期: [2026-03-31 📅]      │
                    │  预计工时: [80] 小时            │
                    │  优先级: [高 🔴 ▼]             │
                    │  状态: [未开始 ▼]              │
                    │  进度: [60% ████████░░]        │
                    │                                 │
                    │        [取消]  [保存]           │
                    └─────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                           BIM项目管理系统 - 工作台                            │
├──────────────┬──────────────────────────────────────────────────────────────┤
│              │  首页 > 工作台                                                │
│  ┌────────┐  ├──────────────────────────────────────────────────────────────┤
│  │ ☰ 菜单 │  │  我的任务统计                                                 │
│  ├────────┤  │  ┌────────────┬────────────┬────────────┬────────────┐      │
│  │        │  │  │ 待开始任务  │ 进行中任务  │ 已完成任务  │ 逾期任务   │      │
│  │ 项目台账│  │  │     5      │     3      │    12      │     1      │      │
│  │工作台◄ │  │  │    ⏳      │    🔄      │    ✅      │    🔴      │      │
│  │工作分解│  │  └────────────┴────────────┴────────────┴────────────┘      │
│  │ 周报管理│  │                                                              │
│  │        │  │  任务筛选: [全部▼] [我的项目▼] [按状态▼] [按优先级▼]          │
│  │        │  │                                                              │
│  │        │  │  ┌───────────────────────────────────────────────────────┐   │
│  │        │  │  │ 我的任务列表 - 看板视图                               │   │
│  │        │  │  │                                                       │   │
│  │        │  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │   │
│  │        │  │  │  │ 待开始 (5)   │  │ 进行中 (3)   │  │ 已完成 (12)  │ │   │
│  │        │  │  │  │              │  │              │  │              │ │   │
│  │        │  │  │  │ ┌──────────┐ │  │ ┌──────────┐ │  │ ┌──────────┐ │ │   │
│  │        │  │  │  │ │装修工程  │ │  │ │主体施工  │ │  │ │现场勘察  │ │ │   │
│  │        │  │  │  │ │刘工      │ │  │ │王工      │ │  │ │王工      │ │ │   │
│  │        │  │  │  │ │01-20     │ │  │ │🔴高优先级│ │  │ │✅完成    │ │ │   │
│  │        │  │  │  │ └──────────┘ │  │ └──────────┘ │  │ └──────────┘ │ │   │
│  │        │  │  │  └──────────────┘  └──────────────┘  └──────────────┘ │   │
│  │        │  │  └───────────────────────────────────────────────────────┘   │
│  └────────┘  │                                                              │
└──────────────┴──────────────────────────────────────────────────────────────┘
```

### 功能需求

#### FR-2.1 工作分解页面

**页面入口**：左侧菜单 "工作分解"

**页面功能**：
1. **项目选择器**：下拉选择要进行工作分解的项目
2. **任务树显示**：以树形结构展示项目的所有任务
   - 支持展开/折叠所有节点
   - 显示任务名称、负责人、进度、状态
   - 不同状态用不同图标标识（未开始⏳、进行中🔄、已完成✅）
3. **任务操作**：
   - 新建根任务（项目级任务）
   - 为任务添加子任务
   - 编辑任务
   - 删除任务（有子任务或不为空时需确认）

**任务树操作**：
- 点击任务节点：在右侧显示任务详情
- 右键菜单：编辑、删除、添加子任务

#### FR-2.2 任务创建/编辑

**弹窗字段**：
- 任务名称（必填）
- 任务描述（多行文本）
- 父任务（选择父任务，根任务为空）
- 负责人（从项目成员中选择）
- 开始日期（日期选择器）
- 结束日期（日期选择器）
- 预计工时（小时）
- 优先级（低🟢/中🟡/高🔴）
- 状态（未开始/进行中/已完成）
- 进度（0-100%滑块）

**验证规则**：
- 任务名称不能为空
- 结束日期不能早于开始日期
- 负责人必选

#### FR-2.3 工作台页面

**页面入口**：左侧菜单 "工作台"

**页面功能**：
1. **任务统计卡片**：显示待开始、进行中、已完成、逾期任务数量
2. **任务筛选**：按项目、状态、优先级筛选
3. **看板视图**：
   - 三列：待开始、进行中、已完成
   - 任务卡片显示：任务名称、项目名称、截止日期、优先级
   - 点击卡片打开任务详情
4. **任务详情**：
   - 显示任务完整信息
   - 支持更新进度和状态
   - 添加工作日志说明
   - 查看任务更新历史

### 技术方案

#### 数据库设计

**tasks 表（任务表）**：
```sql
CREATE TABLE tasks (
  task_id INT PRIMARY KEY AUTO_INCREMENT,
  project_id INT NOT NULL,
  parent_id INT DEFAULT NULL,
  task_name VARCHAR(200) NOT NULL,
  task_desc TEXT,
  assigned_to INT,
  start_date DATE,
  end_date DATE,
  estimated_hours DECIMAL(6,2) DEFAULT 0,
  actual_hours DECIMAL(6,2) DEFAULT 0,
  priority ENUM('low', 'medium', 'high') DEFAULT 'medium',
  status ENUM('pending', 'in_progress', 'completed') DEFAULT 'pending',
  progress INT DEFAULT 0,
  level INT DEFAULT 0,
  sort_order INT DEFAULT 0,
  created_by INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (project_id) REFERENCES projects(project_id) ON DELETE CASCADE,
  FOREIGN KEY (parent_id) REFERENCES tasks(task_id) ON DELETE CASCADE,
  FOREIGN KEY (assigned_to) REFERENCES users(user_id),
  FOREIGN KEY (created_by) REFERENCES users(user_id)
);
```

**task_updates 表（任务更新记录表）**：
```sql
CREATE TABLE task_updates (
  update_id INT PRIMARY KEY AUTO_INCREMENT,
  task_id INT NOT NULL,
  user_id INT NOT NULL,
  old_progress INT,
  new_progress INT,
  old_status ENUM('pending', 'in_progress', 'completed'),
  new_status ENUM('pending', 'in_progress', 'completed'),
  hours_spent DECIMAL(6,2) DEFAULT 0,
  note TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (task_id) REFERENCES tasks(task_id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

#### API 接口设计

```
任务管理：
GET    /api/tasks                    获取任务列表
GET    /api/tasks/:id                获取任务详情
GET    /api/projects/:id/tasks       获取项目的任务树
POST   /api/tasks                    创建任务
PUT    /api/tasks/:id                更新任务
DELETE /api/tasks/:id                删除任务

我的任务（工作台）：
GET    /api/tasks/my                 获取我的任务
GET    /api/tasks/my/stats           获取我的任务统计

任务进度更新：
POST   /api/tasks/:id/updates        更新任务进度
GET    /api/tasks/:id/updates        获取任务更新记录
```

#### 文件变更清单

**新增文件（前端）**：
- `frontend/src/pages/WorkBreakdown.tsx` - 工作分解页面
- `frontend/src/pages/Workbench.tsx` - 工作台页面
- `frontend/src/hooks/useTasks.ts` - 任务数据 hooks

**修改文件（前端）**：
- `frontend/src/App.tsx` - 添加工作分解和工作台路由

**新增文件（后端）**：
- `backend/src/controllers/taskController.ts` - 任务控制器
- `backend/src/services/taskService.ts` - 任务服务
- `backend/src/models/task.ts` - 任务数据模型
- `backend/src/routes/taskRoutes.ts` - 任务路由

**修改文件（后端）**：
- `backend/src/index.ts` - 注册任务路由

**数据库迁移**：
- `database/03-create-tasks.sql` - 创建任务相关表

### 非功能需求

#### NFR-2.1 性能
- 任务树加载时间 < 1 秒
- 看板视图切换流畅

#### NFR-2.2 数据一致性
- 删除任务时级联删除子任务
- 删除项目时级联删除相关任务
- 更新任务进度时记录历史

#### NFR-2.3 用户体验
- 拖拽调整任务顺序（可选）
- 快捷键支持（可选）
- 移动端适配（可选）

### 测试要点

1. **功能测试**
   - 创建根任务和子任务
   - 任务树展开/折叠
   - 任务分配给不同用户
   - 工作台查看自己的任务
   - 更新任务进度

2. **边界测试**
   - 删除有子任务的任务
   - 任务时间超出项目时间
   - 循环引用防护

3. **权限测试**
   - 只能查看分配给自己的任务
   - 管理员可以查看所有任务

### 影响范围

**影响模块**：
- 新增工作分解模块
- 新增工作台模块

**不影响模块**：
- 登录模块
- 用户管理
- 部门管理
- 项目台账（仅添加关联）
- 周报管理

---

## v1.2.0 - 项目台账Excel导出功能

### 功能概述

为项目台账管理页面添加 Excel 导出功能，允许用户将项目数据导出为 Excel 文件，方便离线查看和数据存档。

### 功能原型

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           BIM项目管理系统                                      │
├──────────────┬──────────────────────────────────────────────────────────────┤
│              │  首页 > 项目管理 > 项目台账管理        欢迎, 系统管理员  [退出] │
│              ├──────────────────────────────────────────────────────────────┤
│  ┌────────┐  │  ┌───────────────────────────────────────────────────────┐   │
│  │ ☰ 菜单 │  │  │ 统计看板                                              │   │
│  ├────────┤  │  │ [项目总数:10] [逾期:2] [总金额:2426.8万] ...           │   │
│  │        │  │  └───────────────────────────────────────────────────────┘   │
│  │ 项目台账│  │                                                              │
│  │ 工作台  │  │  ┌───────────────────────────────────────────────────────┐   │
│  │ 工作分解│  │  │ 搜索筛选区域                                           │   │
│  │ 周报管理│  │  │ [搜索框] [项目类型▼] [结算状态▼] [是否逾期▼]           │   │
│  │        │  │  │ [+新增项目] [列设置▼] [📥 导出Excel] [🔄 刷新]          │  ◄─ 新增
│  │        │  │  └───────────────────────────────────────────────────────┘   │
│  │        │  │                                                              │
│  │        │  │  ┌───────────────────────────────────────────────────────┐   │
│  │        │  │  │ 项目列表表格                                           │   │
│  │        │  │  │ ┌──────────┬─────────┬─────────┬─────────┬─────────┐ │   │
│  │        │  │  │ │合同编号  │合同名称 │起止日期 │进度     │操作     │ │   │
│  │        │  │  │ ├──────────┼─────────┼─────────┼─────────┼─────────┤ │   │
│  │        │  │  │ │...      │...      │...      │...      │[详情]... │ │   │
│  │        │  │  │ └──────────┴─────────┴─────────┴─────────┴─────────┘ │   │
│  └────────┘  │  └───────────────────────────────────────────────────────┘   │
└──────────────┴──────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────────┐
                    │   导出确认对话框                  │
                    ├─────────────────────────────────┤
                    │                                 │
                    │  当前数据：10 条记录             │
                    │  将导出当前筛选条件下的所有数据   │
                    │                                 │
                    │  请选择导出字段：                │
                    │  ☑ 合同编号    ☑ 合同名称       │
                    │  ☑ 起止日期    ☑ 合同金额       │
                    │  ☑ 项目进度    ☑ 负责人         │
                    │  ☑ 结算状态    ☑ 签订状态       │
                    │  ☑ 回款金额    ☑ 所属部门       │
                    │  ☑ 项目类型    ☑ 是否逾期       │
                    │  ☐ 备注                           │
                    │                                 │
                    │  [重置默认] [全选] [清空]        │
                    │                                 │
                    │        [取消]  [导出Excel]       │
                    └─────────────────────────────────┘
```

### 功能需求

#### FR-2.1 导出入口
- 在项目台账管理页面的操作栏中添加"导出Excel"按钮
- 按钮带有导出图标，位置在"刷新"按钮左侧
- 点击按钮打开导出配置弹窗

#### FR-2.2 导出弹窗
**显示内容：**
1. 当前数据统计（总记录数）
2. 导出说明（将导出当前筛选条件下的所有数据）
3. 字段选择区域（复选框组）

**字段选项：**
- 合同编号
- 合同名称
- 起止日期
- 合同金额(万元)
- 项目进度(%)
- 项目负责人
- 结算状态
- 签订状态
- 回款金额(万元)
- 所属部门
- 项目类型
- 是否逾期
- 备注

**操作按钮：**
- 重置默认：恢复默认字段选择
- 全选：选中所有字段
- 清空：取消所有选择
- 取消：关闭弹窗
- 导出Excel：执行导出（未选字段时禁用）

#### FR-2.3 导出执行
1. 根据当前筛选条件获取所有符合条件的数据（不分页）
2. 按用户选择的字段生成 Excel 文件
3. 文件命名格式：`项目台账_export_YYYYMMDD_HHMMSS.xlsx`
4. 导出完成后显示成功提示，包含导出记录数
5. 自动触发浏览器下载

#### FR-2.4 边界情况处理
- **无数据**：显示提示"当前没有可导出的数据"
- **未选择字段**：禁用导出按钮，提示"请至少选择一个导出字段"
- **导出失败**：显示错误提示信息

### 技术方案

#### 架构设计
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            架构设计                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐                │
│  │   组件层    │      │   工具层    │      │   数据层    │                │
│  ├─────────────┤      ├─────────────┤      ├─────────────┤                │
│  │             │      │             │      │             │                │
│  │ ProjectLedger│────>│ ExcelUtils  │────>│ xlsx 库     │                │
│  │     Component│     │             │      │             │                │
│  │             │      │ exportExcel │      │ SheetJS     │                │
│  │ - 导出按钮  │      │ - 数据格式化│      │ - 生成文件  │                │
│  │ - 导出弹窗  │      │ - 样式设置  │      │ - 触发下载  │                │
│  └─────────────┘      └─────────────┘      └─────────────┘                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 技术选型
- **前端库**：xlsx (SheetJS) - 纯前端 Excel 导出
- **UI组件**：Ant Design Modal, Checkbox, Button

#### 数据流
1. 用户点击"导出Excel"按钮
2. 打开导出配置弹窗
3. 用户选择导出字段
4. 点击"导出Excel"确认
5. 调用 API 获取当前筛选条件下的所有数据
6. ExcelUtils 处理数据并生成文件
7. 触发浏览器下载

#### 文件变更清单

**新增文件：**
- `frontend/src/utils/excelUtils.ts` - Excel 导出工具函数

**修改文件：**
- `frontend/src/App.tsx` - 项目台账组件
  - 新增导出相关状态
  - 新增导出处理函数
  - 新增导出弹窗组件
  - 新增导出按钮

**依赖安装：**
- `npm install xlsx`

### 非功能需求

#### NFR-2.1 性能
- 导出 1000 条以内数据响应时间 < 2 秒
- 导出 10000 条以内数据响应时间 < 10 秒

#### NFR-2.2 易用性
- 默认勾选常用字段，减少用户操作
- 提供全选/清空/重置快捷操作
- 清晰的提示和错误信息

#### NFR-2.3 兼容性
- 支持现代浏览器（Chrome, Edge, Firefox, Safari）
- Excel 文件格式兼容 Excel 2007+

### 测试要点

1. **功能测试**
   - 导出按钮点击打开弹窗
   - 字段选择功能正常
   - 重置/全选/清空按钮正常
   - 导出生成文件并下载
   - 文件内容正确

2. **边界测试**
   - 无数据时的提示
   - 未选字段时的禁用状态
   - 大数据量导出

3. **兼容性测试**
   - 不同浏览器导出功能
   - Excel 文件打开正常

### 影响范围

**影响模块：**
- 项目台账管理（ProjectLedger 组件）

**不影响模块：**
- 登录模块
- 用户管理
- 部门管理
- 数据获取 hooks
- 路由配置
- 认证上下文

---

## 附录

### A. Excel 导出文件格式示例

| 序号 | 合同编号 | 合同名称 | 起止日期 | 合同金额(万元) | 项目进度(%) | 项目负责人 | 结算状态 | 签订状态 | 回款金额(万元) | 所属部门 | 项目类型 |
|------|----------|----------|----------|----------------|-------------|------------|----------|----------|-----------------|----------|----------|
| 1 | 局0113202601019001 | XX大厦BIM项目 | 2026-01-01 ~ 2026-12-31 | 120.50 | 100% | 王工 | 结算完成 | 已签订 | 120.50 | 项目部 | 建筑施工 |
| 2 | 局0113202601019002 | YY花园景观设计 | 2026-02-15 ~ 2026-08-31 | 89.00 | 65% | 王工 | 部分结算 | 已签订 | 45.00 | 项目部 | 园林景观 |

### B. 接口定义

```typescript
// excelUtils.ts

interface ExportColumnConfig {
  key: string;
  title: string;
  width: number;
  formatter?: (value: any, row: any) => any;
}

interface ExportConfig {
  columns: string[];
}

// 主导出函数
export const exportProjectsToExcel = (
  data: ProjectData[],
  config: ExportConfig,
  options?: { filename?: string }
): void;

// 获取默认导出字段
export const getDefaultExportColumns = (): string[];
```

### C. 默认导出字段

默认勾选的导出字段（按顺序）：
1. 合同编号
2. 合同名称
3. 起止日期
4. 合同金额(万元)
5. 项目进度(%)
6. 项目负责人
7. 结算状态
8. 签订状态
9. 回款金额(万元)
10. 所属部门
11. 项目类型
