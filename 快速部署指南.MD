# BIMé¡¹ç›®ç®¡ç†ç³»ç»Ÿ - å¿«é€Ÿé‡æ–°éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£æä¾›å¿«é€Ÿé‡æ–°éƒ¨ç½²çš„å®Œæ•´æµç¨‹ï¼Œé€‚ç”¨äºä»£ç æ›´æ–°åå¿«é€Ÿä¸Šçº¿ã€‚

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨IP**: 47.122.112.158
- **SSHç«¯å£**: 22
- **æ“ä½œç³»ç»Ÿ**: Alibaba Cloud Linux
- **Node.jsç‰ˆæœ¬**: v20.11.1

### é¡¹ç›®è·¯å¾„
```
/www/wwwroot/BIMPMS/
â”œâ”€â”€ backend/          # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ dist/        # ç¼–è¯‘åçš„ä»£ç 
â”‚   â””â”€â”€ .env         # ç¯å¢ƒå˜é‡
â””â”€â”€ frontend/        # å‰ç«¯ä»£ç 
    â””â”€â”€ dist/        # æ„å»ºåçš„é™æ€æ–‡ä»¶
```

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æµç¨‹

### æ­¥éª¤1: æœ¬åœ°æ„å»ºå‰ç«¯ï¼ˆWindowsï¼‰

**æ–¹æ³•A: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰**

```batch
# åŒå‡»è¿è¡Œæˆ–åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ
deploy-frontend.bat
```

**æ–¹æ³•B: æ‰‹åŠ¨æ„å»º**

```batch
cd "d:\project\BIM PMS\frontend"
npm run build
```

æ„å»ºå®Œæˆåï¼Œäº§ç‰©åœ¨ `frontend/dist` ç›®å½•ã€‚

---

### æ­¥éª¤2: ä¸Šä¼ å‰ç«¯æ–‡ä»¶

**æ–¹æ³•A: ä½¿ç”¨å®å¡”é¢æ¿ï¼ˆæ¨èï¼‰**

1. å‹ç¼© `frontend/dist` ä¸º `dist.zip`
2. ç™»å½•å®å¡”é¢æ¿: http://47.122.112.158:8888
3. è¿›å…¥æ–‡ä»¶ç®¡ç† -> `/www/wwwroot/BIMPMS/frontend/`
4. åˆ é™¤æ—§çš„ `dist` ç›®å½•
5. ä¸Šä¼  `dist.zip` å¹¶è§£å‹

**æ–¹æ³•B: ä½¿ç”¨WinSCP/FileZilla**

1. è¿æ¥åˆ°æœåŠ¡å™¨: 47.122.112.158:22
2. ä¸Šä¼  `frontend/dist` æ•´ä¸ªç›®å½•
3. ç›®æ ‡è·¯å¾„: `/www/wwwroot/BIMPMS/frontend/dist`

**æ–¹æ³•C: ä½¿ç”¨SCPå‘½ä»¤è¡Œ**

```bash
scp -r frontend/dist/* root@47.122.112.158:/www/wwwroot/BIMPMS/frontend/dist/
```

---

### æ­¥éª¤3: æœåŠ¡å™¨ç«¯éƒ¨ç½²

**æ–¹æ³•A: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
# 1. ç™»å½•æœåŠ¡å™¨
ssh root@47.122.112.158

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/BIMPMS

# 3. ä¸Šä¼ å¹¶æ‰§è¡Œéƒ¨ç½²è„šæœ¬
# (ç¡®ä¿ deploy.sh å·²ä¸Šä¼ )
chmod +x deploy.sh
./deploy.sh
```

**æ–¹æ³•B: æ‰‹åŠ¨éƒ¨ç½²**

```bash
# 1. ç™»å½•æœåŠ¡å™¨
ssh root@47.122.112.158

# 2. æ›´æ–°åç«¯
cd /www/wwwroot/BIMPMS/backend

# æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨Gitï¼‰
git pull

# å®‰è£…ä¾èµ–
npm install --registry=https://registry.npmmirror.com

# æ„å»ºé¡¹ç›®
npm run build

# 3. é‡å¯åç«¯æœåŠ¡
/www/server/nodejs/v20.11.1/bin/pm2 restart bimpms-backend

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
/www/server/nodejs/v20.11.1/bin/pm2 status

# 5. æŸ¥çœ‹æ—¥å¿—ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼‰
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend --lines 50
```

---

### æ­¥éª¤4: éªŒè¯éƒ¨ç½²

1. **æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€**
   ```bash
   curl http://localhost:3000/health
   # é¢„æœŸè¿”å›: {"status":"ok","timestamp":"..."}
   ```

2. **è®¿é—®å‰ç«¯**
   ```
   http://47.122.112.158
   ```

3. **ç™»å½•æµ‹è¯•**
   - ç”¨æˆ·å: `admin`
   - å¯†ç : `123`

---

## ğŸ“ éƒ¨ç½²è„šæœ¬è¯´æ˜

### æœ¬åœ°æ„å»ºè„šæœ¬: `deploy-frontend.bat`

**åŠŸèƒ½**:
- âœ“ è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒ
- âœ“ è‡ªåŠ¨æ¸…ç†æ—§æ„å»º
- âœ“ æ‰§è¡Œå‰ç«¯æ„å»º
- âœ“ éªŒè¯æ„å»ºäº§ç‰©
- âœ“ æä¾›ä¸Šä¼ æŒ‡å¼•

**ä½¿ç”¨æ–¹æ³•**:
```batch
åŒå‡»è¿è¡Œ deploy-frontend.bat
```

### æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬: `deploy.sh`

**åŠŸèƒ½**:
- âœ“ æ£€æŸ¥é¡¹ç›®ç›®å½•
- âœ“ è‡ªåŠ¨æ›´æ–°åç«¯ä»£ç 
- âœ“ å®‰è£…ä¾èµ–å¹¶æ„å»º
- âœ“ é‡å¯PM2æœåŠ¡
- âœ“ éªŒè¯æœåŠ¡çŠ¶æ€
- âœ“ æ˜¾ç¤ºè®¿é—®ä¿¡æ¯

**ä½¿ç”¨æ–¹æ³•**:
```bash
chmod +x deploy.sh
./deploy.sh
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### åç«¯æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹åç«¯çŠ¶æ€
/www/server/nodejs/v20.11.1/bin/pm2 status

# æŸ¥çœ‹åç«¯æ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend --lines 50

# é‡å¯åç«¯
/www/server/nodejs/v20.11.1/bin/pm2 restart bimpms-backend

# åœæ­¢åç«¯
/www/server/nodejs/v20.11.1/bin/pm2 stop bimpms-backend

# å¯åŠ¨åç«¯
/www/server/nodejs/v20.11.1/bin/pm2 start bimpms-backend
```

### Nginxç®¡ç†

```bash
# æµ‹è¯•é…ç½®
nginx -t

# é‡è½½é…ç½®
nginx -s reload

# é‡å¯Nginx
systemctl restart nginx

# æŸ¥çœ‹NginxçŠ¶æ€
systemctl status nginx
```

### MySQLç®¡ç†

```bash
# ç™»å½•MySQL
mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms

# å¤‡ä»½æ•°æ®åº“
mysqldump -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms > backup.sql

# æ¢å¤æ•°æ®åº“
mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms < backup.sql
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# Nginxè®¿é—®æ—¥å¿—
tail -f /www/wwwlogs/www.sjyxmgl.com.log

# Nginxé”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/www.sjyxmgl.com.error.log

# PM2æ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. åç«¯å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: PM2æ˜¾ç¤ºè¿›ç¨‹å¤„äº `errored` çŠ¶æ€

**è§£å†³æ–¹æ³•**:
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend --lines 100

# å¸¸è§åŸå› :
# 1. æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥ .env é…ç½®
# 2. ç«¯å£è¢«å ç”¨ â†’ lsof -i :3000
# 3. ä¾èµ–ç¼ºå¤± â†’ npm install
```

### 2. å‰ç«¯APIè¯·æ±‚å¤±è´¥

**ç—‡çŠ¶**: ç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤º"è¯·æ£€æŸ¥åç«¯æœåŠ¡"

**æ£€æŸ¥æ¸…å•**:
1. åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ: `pm2 status`
2. åç«¯å¥åº·æ£€æŸ¥: `curl http://localhost:3000/health`
3. Nginxé…ç½®æ˜¯å¦æ­£ç¡®
4. é˜²ç«å¢™ç«¯å£æ˜¯å¦å¼€æ”¾

### 3. é¡µé¢404

**ç—‡çŠ¶**: åˆ·æ–°é¡µé¢æ˜¾ç¤º404

**è§£å†³æ–¹æ³•**:
æ£€æŸ¥Nginxé…ç½®æ˜¯å¦åŒ…å« `try_files`:
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

### 4. æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: åç«¯æ—¥å¿—æ˜¾ç¤º "ER_ACCESS_DENIED_ERROR"

**è§£å†³æ–¹æ³•**:
```sql
-- é‡æ–°åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ
DROP USER IF EXISTS 'bimpms_user'@'localhost';
CREATE USER 'bimpms_user'@'localhost' IDENTIFIED BY 'LkkWtYtjPrRiMKs8';
GRANT ALL PRIVILEGES ON bimpms.* TO 'bimpms_user'@'localhost';
FLUSH PRIVILEGES;
```

---

## ğŸ“Š éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤:
- [ ] ä»£ç å·²æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“è„šæœ¬å‡†å¤‡ï¼ˆå¦‚æœ‰å˜æ›´ï¼‰

éƒ¨ç½²åéªŒè¯:
- [ ] åç«¯å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] APIè¯·æ±‚æ­£å¸¸
- [ ] å·¥ä½œå°é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] é¡¹ç›®å°è´¦åŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·ç®¡ç†åŠŸèƒ½æ­£å¸¸

---

## ğŸ”„ ç‰ˆæœ¬å›æ»š

å¦‚æœæ–°ç‰ˆæœ¬å‡ºç°é—®é¢˜ï¼Œå¿«é€Ÿå›æ»šæ­¥éª¤:

### å‰ç«¯å›æ»š
```bash
# å¤‡ä»½å½“å‰ç‰ˆæœ¬
cd /www/wwwroot/BIMPMS/frontend
mv dist dist_new

# æ¢å¤æ—§ç‰ˆæœ¬
mv dist_backup dist

# é‡è½½Nginx
nginx -s reload
```

### åç«¯å›æ»š
```bash
# æŸ¥çœ‹PM2ç‰ˆæœ¬åˆ—è¡¨
/www/server/nodejs/v20.11.1/bin/pm2 list

# å›æ»šåˆ°æ—§ç‰ˆæœ¬
/www/server/nodejs/v20.11.1/bin/pm2 restart bimpms-backend
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥:
1. æœåŠ¡å™¨æ—¥å¿—: `/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend`
2. Nginxæ—¥å¿—: `/www/wwwlogs/www.sjyxmgl.com.error.log`
3. æ•°æ®åº“æ—¥å¿—: `/var/log/mysqld.log`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-14
**ç»´æŠ¤è€…**: BIMé¡¹ç›®ç®¡ç†ç³»ç»Ÿå›¢é˜Ÿ
