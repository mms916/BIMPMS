# BIMé¡¹ç›®ç®¡ç†ç³»ç»Ÿ - å®å¡”é¢æ¿ä»é›¶éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£æä¾›ä½¿ç”¨å®å¡”é¢æ¿ä»é›¶å¼€å§‹éƒ¨ç½²BIMé¡¹ç›®ç®¡ç†ç³»ç»Ÿçš„å®Œæ•´æ­¥éª¤ã€‚

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨IP**: 47.122.112.158
- **æ“ä½œç³»ç»Ÿ**: Alibaba Cloud Linux
- **å®å¡”é¢æ¿**: http://47.122.112.158:8888

### è½¯ä»¶è¦æ±‚ï¼ˆåœ¨å®å¡”é¢æ¿å®‰è£…ï¼‰
- **Nginx**: 1.28.0
- **MySQL**: 8.0.36
- **Node.js**: v20.11.1
- **PM2ç®¡ç†å™¨**: æœ€æ–°ç‰ˆ

### GitHubä»“åº“
- **ä»“åº“åœ°å€**: https://github.com/mms916/BIMPMS

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…å¿…è¦è½¯ä»¶

#### 1.1 ç™»å½•å®å¡”é¢æ¿

è®¿é—®ï¼šhttp://47.122.112.158:8888

#### 1.2 å®‰è£…Node.js

1. ç‚¹å‡»å·¦ä¾§ **è½¯ä»¶å•†åº—**
2. æœç´¢ **Nodeé¡¹ç›®ç‰ˆæœ¬ç®¡ç†**
3. ç‚¹å‡» **å®‰è£…**
4. å®‰è£…å®Œæˆåï¼Œç‚¹å‡» **è®¾ç½®**
5. å®‰è£… **Node.js v20.11.1**

#### 1.3 å®‰è£…PM2ç®¡ç†å™¨

1. åœ¨è½¯ä»¶å•†åº—æœç´¢ **PM2ç®¡ç†å™¨**
2. ç‚¹å‡» **å®‰è£…**

#### 1.4 éªŒè¯å®‰è£…

æ‰“å¼€å®å¡”ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š

```bash
# éªŒè¯Node.js
node -v

# éªŒè¯npm
npm -v

# éªŒè¯PM2
/www/server/nodejs/v20.11.1/bin/pm2 --version
```

---

### ç¬¬äºŒæ­¥ï¼šæ¸…ç†æ—§æ•°æ®

#### 2.1 åœæ­¢å¹¶åˆ é™¤æ—§çš„PM2æœåŠ¡

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# æŸ¥çœ‹ç°æœ‰æœåŠ¡
/www/server/nodejs/v20.11.1/bin/pm2 list

# åœæ­¢æœåŠ¡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
/www/server/nodejs/v20.11.1/bin/pm2 stop bimpms-backend

# åˆ é™¤æœåŠ¡
/www/server/nodejs/v20.11.1/bin/pm2 delete bimpms-backend
```

#### 2.2 åˆ é™¤æ—§é¡¹ç›®ç›®å½•

```bash
# åˆ é™¤é¡¹ç›®ç›®å½•
rm -rf /www/wwwroot/BIMPMS

# é‡æ–°åˆ›å»ºç›®å½•
mkdir -p /www/wwwroot/BIMPMS
```

#### 2.3 åˆ é™¤æ—§æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰

åœ¨å®å¡”é¢æ¿æ“ä½œï¼š
1. ç‚¹å‡»å·¦ä¾§ **æ•°æ®åº“**
2. æ‰¾åˆ° **bimpms** æ•°æ®åº“
3. ç‚¹å‡» **åˆ é™¤**

---

### ç¬¬ä¸‰æ­¥ï¼šå…‹éš†ä»£ç 

#### 3.1 å®‰è£…Gitï¼ˆå¦‚æœæœªå®‰è£…ï¼‰

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# å®‰è£…Git
yum install -y git

# éªŒè¯å®‰è£…
git --version
```

#### 3.2 é…ç½®Git

```bash
# æ·»åŠ å®‰å…¨ç›®å½•
git config --global --add safe.directory /www/wwwroot/BIMPMS

# é…ç½®ç”¨æˆ·ä¿¡æ¯
git config --global user.name "BIMPMS"
git config --global user.email "admin@sjyxmgl.com"
```

#### 3.3 å…‹éš†ä»£ç 

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/BIMPMS

# å…‹éš†ä»£ç 
git clone https://github.com/mms916/BIMPMS.git .

# æŸ¥çœ‹æ–‡ä»¶
ls -la
```

---

### ç¬¬å››æ­¥ï¼šåˆ›å»ºæ•°æ®åº“

#### 4.1 åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

**æ–¹æ³•1ï¼šä½¿ç”¨å®å¡”é¢æ¿ï¼ˆæ¨èï¼‰**

1. ç‚¹å‡»å·¦ä¾§ **æ•°æ®åº“**
2. ç‚¹å‡» **æ·»åŠ æ•°æ®åº“**
   - æ•°æ®åº“åï¼š`bimpms`
   - ç”¨æˆ·åï¼š`bimpms_user`
   - å¯†ç ï¼š`LkkWtYtjPrRiMKs8`
   - è®¿é—®æƒé™ï¼šæœ¬åœ°æœåŠ¡å™¨
3. ç‚¹å‡» **æäº¤**

**æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œ**

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# ç™»å½•MySQLï¼ˆè¯·ä¿®æ”¹å¯†ç ï¼‰
mysql -u root -p'ä½ çš„MySQL rootå¯†ç '

# æ‰§è¡ŒSQLå‘½ä»¤
CREATE DATABASE bimpms CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'bimpms_user'@'localhost' IDENTIFIED BY 'LkkWtYtjPrRiMKs8';
GRANT ALL PRIVILEGES ON bimpms.* TO 'bimpms_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

#### 4.2 å¯¼å…¥æ•°æ®åº“æ•°æ®

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# å¯¼å…¥æ•°æ®åº“ç»“æ„
sed 's/bim_pms/bimpms/g' /www/wwwroot/BIMPMS/database/01-init-schema.sql | mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms

# å¯¼å…¥åˆå§‹æ•°æ®
sed 's/bim_pms/bimpms/g' /www/wwwroot/BIMPMS/database/02-seed-data.sql | mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms

# å¯¼å…¥ä»»åŠ¡è¡¨
mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms < /www/wwwroot/BIMPMS/database/03-create-tasks.sql

# å¯¼å…¥éƒ¨é—¨æ ‘ç»“æ„
mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms < /www/wwwroot/BIMPMS/database/04-add-department-tree.sql
```

#### 4.3 éªŒè¯æ•°æ®åº“

åœ¨å®å¡”é¢æ¿ï¼š
1. ç‚¹å‡» **æ•°æ®åº“**
2. æ‰¾åˆ° **bimpms** æ•°æ®åº“
3. ç‚¹å‡» **ç®¡ç†**
4. æŸ¥çœ‹è¡¨æ˜¯å¦å­˜åœ¨ï¼ˆåº”è¯¥æœ‰users, departments, projectsç­‰è¡¨ï¼‰

---

### ç¬¬äº”æ­¥ï¼šé…ç½®åç«¯

#### 5.1 åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# åˆ›å»º.envæ–‡ä»¶
cat > /www/wwwroot/BIMPMS/backend/.env << 'EOF'
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=bimpms_user
DB_PASSWORD=LkkWtYtjPrRiMKs8
DB_NAME=bimpms

# JWTå¯†é’¥
JWT_SECRET=a8f3d9e2c7b1x5k9m3n6p0q2w4r8t0u1v3y5z7
JWT_EXPIRES_IN=7d

# åŠ å¯†é…ç½®
BCRYPT_ROUNDS=10
EOF

# éªŒè¯æ–‡ä»¶
cat /www/wwwroot/BIMPMS/backend/.env
```

**æˆ–è€…ä½¿ç”¨å®å¡”æ–‡ä»¶ç¼–è¾‘å™¨ï¼š**

1. ç‚¹å‡»å·¦ä¾§ **æ–‡ä»¶**
2. è¿›å…¥ `/www/wwwroot/BIMPMS/backend/`
3. æ–°å»ºæ–‡ä»¶ `.env`
4. ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š

```ini
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=bimpms_user
DB_PASSWORD=LkkWtYtjPrRiMKs8
DB_NAME=bimpms

# JWTå¯†é’¥
JWT_SECRET=a8f3d9e2c7b1x5k9m3n6p0q2w4r8t0u1v3y5z7
JWT_EXPIRES_IN=7d

# åŠ å¯†é…ç½®
BCRYPT_ROUNDS=10
```

#### 5.2 å®‰è£…åç«¯ä¾èµ–

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# è¿›å…¥åç«¯ç›®å½•
cd /www/wwwroot/BIMPMS/backend

# å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨æ·˜å®é•œåƒåŠ é€Ÿï¼‰
npm install --registry=https://registry.npmmirror.com

# ç­‰å¾…å®‰è£…å®Œæˆ...
```

#### 5.3 æ„å»ºåç«¯

```bash
# ä»åœ¨åç«¯ç›®å½•æ‰§è¡Œ
npm run build

# éªŒè¯æ„å»ºäº§ç‰©
ls -la dist/
# åº”è¯¥çœ‹åˆ° index.js ç­‰æ–‡ä»¶
```

---

### ç¬¬å…­æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

#### 6.1 ä½¿ç”¨PM2ç®¡ç†å™¨å¯åŠ¨ï¼ˆæ¨èï¼‰

1. ç‚¹å‡»å·¦ä¾§ **è½¯ä»¶å•†åº—**
2. æ‰¾åˆ° **PM2ç®¡ç†å™¨**ï¼Œç‚¹å‡» **è®¾ç½®**
3. ç‚¹å‡» **æ·»åŠ é¡¹ç›®**
   - é¡¹ç›®ç›®å½•ï¼š`/www/wwwroot/BIMPMS/backend`
   - å¯åŠ¨æ–‡ä»¶ï¼š`dist/index.js`
   - é¡¹ç›®åç§°ï¼š`bimpms-backend`
   - è¿è¡Œæ¨¡å¼ï¼š`fork`
4. ç‚¹å‡» **æäº¤**

#### 6.2 æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# è¿›å…¥åç«¯ç›®å½•
cd /www/wwwroot/BIMPMS/backend

# å¯åŠ¨æœåŠ¡
/www/server/nodejs/v20.11.1/bin/pm2 start dist/index.js \
    --name bimpms-backend \
    --cwd /www/wwwroot/BIMPMS/backend

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
/www/server/nodejs/v20.11.1/bin/pm2 status

# æŸ¥çœ‹æ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend --lines 20
```

#### 6.3 éªŒè¯åç«¯è¿è¡Œ

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# é¢„æœŸè¿”å›ï¼š{"status":"ok","timestamp":"..."}
```

---

### ç¬¬ä¸ƒæ­¥ï¼šæ„å»ºå‰ç«¯

#### 7.1 åœ¨æœ¬åœ°ç”µè„‘æ„å»º

**åœ¨æœ¬åœ°Windowsç”µè„‘æ‰§è¡Œï¼š**

```batch
# è¿›å…¥å‰ç«¯ç›®å½•
cd "d:\project\BIM PMS\frontend"

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æˆ–è·³è¿‡TypeScriptæ£€æŸ¥
npx vite build
```

#### 7.2 å‹ç¼©æ„å»ºäº§ç‰©

**æ–¹æ³•1ï¼šä½¿ç”¨Windowsèµ„æºç®¡ç†å™¨**

1. æ‰“å¼€ `d:\project\BIM PMS\frontend\dist` ç›®å½•
2. å³é”®ç‚¹å‡» `dist` æ–‡ä»¶å¤¹
3. å‘é€åˆ° â†’ å‹ç¼©(zipped)æ–‡ä»¶å¤¹
4. é‡å‘½åä¸º `dist.zip`

**æ–¹æ³•2ï¼šä½¿ç”¨PowerShell**

```powershell
cd "d:\project\BIM PMS\frontend"
Compress-Archive -Path dist -DestinationPath dist.zip -Force
```

---

### ç¬¬å…«æ­¥ï¼šä¸Šä¼ å‰ç«¯æ–‡ä»¶

#### 8.1 ä½¿ç”¨å®å¡”é¢æ¿ä¸Šä¼ 

1. ç‚¹å‡»å·¦ä¾§ **æ–‡ä»¶**
2. è¿›å…¥ `/www/wwwroot/BIMPMS/frontend/`
3. å¦‚æœæœ‰æ—§çš„ `dist` ç›®å½•ï¼Œå…ˆåˆ é™¤
4. ç‚¹å‡» **ä¸Šä¼ **
5. é€‰æ‹© `dist.zip` æ–‡ä»¶ä¸Šä¼ 
6. ä¸Šä¼ å®Œæˆåï¼Œå³é”®ç‚¹å‡» `dist.zip`
7. é€‰æ‹© **è§£å‹**
8. è§£å‹åˆ°å½“å‰ç›®å½•
9. åˆ é™¤ `dist.zip`

#### 8.2 éªŒè¯å‰ç«¯æ–‡ä»¶

åœ¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸­ï¼š
- è¿›å…¥ `/www/wwwroot/BIMPMS/frontend/dist/`
- åº”è¯¥çœ‹åˆ°ï¼š`index.html` å’Œ `assets` ç›®å½•

æˆ–åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
ls -la /www/wwwroot/BIMPMS/frontend/dist/
```

---

### ç¬¬ä¹æ­¥ï¼šé…ç½®Nginx

#### 9.1 æ·»åŠ ç½‘ç«™

1. ç‚¹å‡»å·¦ä¾§ **ç½‘ç«™**
2. ç‚¹å‡» **æ·»åŠ ç«™ç‚¹**
3. å¡«å†™ä¿¡æ¯ï¼š
   - **åŸŸå**ï¼š`47.122.112.158`ï¼ˆæˆ–ä½ çš„åŸŸåï¼‰
   - **æ ¹ç›®å½•**ï¼š`/www/wwwroot/BIMPMS/frontend/dist`
   - **FTP**ï¼šä¸åˆ›å»º
   - **æ•°æ®åº“**ï¼šä¸åˆ›å»º
   - **PHPç‰ˆæœ¬**ï¼šçº¯é™æ€
4. ç‚¹å‡» **æäº¤**

#### 9.2 ä¿®æ”¹ç½‘ç«™é…ç½®

1. åœ¨ç½‘ç«™åˆ—è¡¨ä¸­æ‰¾åˆ°åˆšåˆ›å»ºçš„ç«™ç‚¹
2. ç‚¹å‡» **è®¾ç½®**
3. ç‚¹å‡» **é…ç½®æ–‡ä»¶**
4. æ›¿æ¢ä¸ºä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name 47.122.112.158;
    root /www/wwwroot/BIMPMS/frontend/dist;
    index index.html;

    # SPAè·¯ç”±æ”¯æŒ - å¤„ç†React Router
    location / {
        try_files $uri $uri/ /index.html;
    }

    # APIåå‘ä»£ç†åˆ°åç«¯
    location /api {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~ ^/(\.user.ini|\.htaccess|\.git|\.env) {
        return 404;
    }

    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        return 404;
    }

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;

    # è®¿é—®æ—¥å¿—
    access_log /www/wwwlogs/bimpms.access.log;
    error_log /www/wwwlogs/bimpms.error.log;
}
```

5. ç‚¹å‡» **ä¿å­˜**

#### 9.3 é‡è½½Nginx

åœ¨å®å¡”é¢æ¿é¦–é¡µï¼š
- æ‰¾åˆ° **Nginx**
- ç‚¹å‡» **é‡è½½é…ç½®**

æˆ–åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
nginx -s reload
```

---

### ç¬¬åæ­¥ï¼šéªŒè¯éƒ¨ç½²

#### 10.1 æ£€æŸ¥åç«¯æœåŠ¡

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# æŸ¥çœ‹PM2æœåŠ¡çŠ¶æ€
/www/server/nodejs/v20.11.1/bin/pm2 status

# æŸ¥çœ‹åç«¯æ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend --lines 20

# æµ‹è¯•åç«¯API
curl http://localhost:3000/health

# æµ‹è¯•å‰ç«¯è®¿é—®
curl http://47.122.112.158
```

#### 10.2 æµè§ˆå™¨è®¿é—®æµ‹è¯•

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://47.122.112.158
2. åº”è¯¥çœ‹åˆ°ç™»å½•é¡µé¢
3. ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•ï¼š
   - **ç”¨æˆ·å**ï¼š`admin`
   - **å¯†ç **ï¼š`123`

#### 10.3 åŠŸèƒ½æµ‹è¯•

ç™»å½•åæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

- [ ] å·¥ä½œå°é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] é¡¹ç›®å°è´¦åŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] å·¥ä½œåˆ†è§£åŠŸèƒ½æ­£å¸¸
- [ ] èƒ½å¤Ÿæ­£å¸¸é€€å‡ºç™»å½•

---

## ğŸ“Š éƒ¨ç½²ç»“æ„

æœ€ç»ˆç›®å½•ç»“æ„ï¼š

```
/www/wwwroot/BIMPMS/
â”œâ”€â”€ backend/              # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ dist/            # ç¼–è¯‘åçš„ä»£ç 
â”‚   â”‚   â””â”€â”€ index.js     # å¯åŠ¨æ–‡ä»¶
â”‚   â”œâ”€â”€ node_modules/    # ä¾èµ–åŒ…
â”‚   â”œâ”€â”€ src/             # æºä»£ç 
â”‚   â””â”€â”€ .env             # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ frontend/            # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ dist/            # æ„å»ºåçš„é™æ€æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.html   # å…¥å£æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ assets/      # é™æ€èµ„æº
â”‚   â””â”€â”€ src/             # æºä»£ç 
â”œâ”€â”€ database/            # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ 01-init-schema.sql
â”‚   â”œâ”€â”€ 02-seed-data.sql
â”‚   â”œâ”€â”€ 03-create-tasks.sql
â”‚   â””â”€â”€ 04-add-department-tree.sql
â””â”€â”€ .git/                # Gitç‰ˆæœ¬æ§åˆ¶
```

---

## ğŸ”§ å¸¸ç”¨è¿ç»´å‘½ä»¤

### åç«¯æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
/www/server/nodejs/v20.11.1/bin/pm2 status

# æŸ¥çœ‹æ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend --lines 50

# é‡å¯æœåŠ¡
/www/server/nodejs/v20.11.1/bin/pm2 restart bimpms-backend

# åœæ­¢æœåŠ¡
/www/server/nodejs/v20.11.1/bin/pm2 stop bimpms-backend

# å¯åŠ¨æœåŠ¡
/www/server/nodejs/v20.11.1/bin/pm2 start bimpms-backend
```

### Nginxç®¡ç†

```bash
# æµ‹è¯•é…ç½®
nginx -t

# é‡è½½é…ç½®
nginx -s reload

# é‡å¯Nginx
systemctl restart nginx

# æŸ¥çœ‹NginxçŠ¶æ€
systemctl status nginx
```

### æ•°æ®åº“ç®¡ç†

```bash
# ç™»å½•MySQL
mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms

# å¤‡ä»½æ•°æ®åº“
mysqldump -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms < backup_20250114.sql
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# PM2æ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend

# Nginxè®¿é—®æ—¥å¿—
tail -f /www/wwwlogs/bimpms.access.log

# Nginxé”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/bimpms.error.log
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²æµç¨‹

å½“æœ‰ä»£ç æ›´æ–°æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ›´æ–°ï¼š

### å‰ç«¯æ›´æ–°

```bash
# 1. æœ¬åœ°æ„å»º
cd "d:\project\BIM PMS\frontend"
npm run build

# 2. å‹ç¼©distç›®å½•ä¸ºdist.zip

# 3. åœ¨å®å¡”é¢æ¿ä¸Šä¼ dist.zipåˆ° /www/wwwroot/BIMPMS/frontend/

# 4. è§£å‹å¹¶æ›¿æ¢
```

### åç«¯æ›´æ–°

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
cd /www/wwwroot/BIMPMS
git pull origin main

# 2. å®‰è£…æ–°ä¾èµ–
cd /www/wwwroot/BIMPMS/backend
npm install --registry=https://registry.npmmirror.com

# 3. é‡æ–°æ„å»º
npm run build

# 4. é‡å¯æœåŠ¡
/www/server/nodejs/v20.11.1/bin/pm2 restart bimpms-backend

# 5. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend --lines 20
```

### æ•°æ®åº“æ›´æ–°

```bash
# å¦‚æœæœ‰æ–°çš„æ•°æ®åº“è„šæœ¬
mysql -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms < /path/to/new-script.sql
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. åç«¯å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼šPM2æ˜¾ç¤ºè¿›ç¨‹å¤„äº `errored` çŠ¶æ€

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
/www/server/nodejs/v20.11.1/bin/pm2 logs bimpms-backend --lines 100

# å¸¸è§åŸå› ï¼š
# 1. æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥ .env é…ç½®
# 2. ç«¯å£è¢«å ç”¨ â†’ lsof -i :3000
# 3. ä¾èµ–ç¼ºå¤± â†’ npm install
```

### 2. å‰ç«¯APIè¯·æ±‚å¤±è´¥

**ç—‡çŠ¶**ï¼šç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤º"è¯·æ£€æŸ¥åç«¯æœåŠ¡"

**æ£€æŸ¥æ¸…å•**ï¼š

```bash
# 1. æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
/www/server/nodejs/v20.11.1/bin/pm2 status

# 2. æ£€æŸ¥åç«¯å¥åº·
curl http://localhost:3000/health

# 3. æ£€æŸ¥Nginxé…ç½®
nginx -t

# 4. é‡è½½Nginx
nginx -s reload
```

### 3. é¡µé¢åˆ·æ–°404

**ç—‡çŠ¶**ï¼šåˆ·æ–°é¡µé¢æ˜¾ç¤º404

**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥Nginxé…ç½®æ˜¯å¦åŒ…å« `try_files`

```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

### 4. æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šåç«¯æ—¥å¿—æ˜¾ç¤º "ER_ACCESS_DENIED_ERROR"

**è§£å†³æ–¹æ³•**ï¼š

```sql
-- åœ¨å®å¡”é¢æ¿æˆ–ç»ˆç«¯æ‰§è¡Œ
DROP USER IF EXISTS 'bimpms_user'@'localhost';
CREATE USER 'bimpms_user'@'localhost' IDENTIFIED BY 'LkkWtYtjPrRiMKs8';
GRANT ALL PRIVILEGES ON bimpms.* TO 'bimpms_user'@'localhost';
FLUSH PRIVILEGES;
```

### 5. Git pullå¤±è´¥

**ç—‡çŠ¶**ï¼šæç¤º "detected dubious ownership"

**è§£å†³æ–¹æ³•**ï¼š

```bash
git config --global --add safe.directory /www/wwwroot/BIMPMS
```

---

## ğŸ” å®‰å…¨å»ºè®®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

ç™»å½•ç³»ç»Ÿåç«‹å³ä¿®æ”¹adminå¯†ç ï¼š

1. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å
2. é€‰æ‹© **ä¿®æ”¹å¯†ç **
3. è¾“å…¥æ–°å¯†ç 

### 2. é™åˆ¶SSHè®¿é—®

```bash
# åªå…è®¸ç‰¹å®šIPè®¿é—®SSH
# åœ¨å®å¡”é¢æ¿ â†’ å®‰å…¨ â†’ é˜²ç«å¢™
# æ·»åŠ è§„åˆ™ï¼šåªå…è®¸ä½ çš„IPè®¿é—®22ç«¯å£
```

### 3. å¯ç”¨HTTPSï¼ˆå¯é€‰ï¼‰

1. åœ¨å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ ç«™ç‚¹è®¾ç½®
2. ç‚¹å‡» **SSL**
3. ç”³è¯·Let's Encryptå…è´¹è¯ä¹¦
4. å¼€å¯ **å¼ºåˆ¶HTTPS**

### 4. å®šæœŸå¤‡ä»½

åœ¨å®å¡”é¢æ¿ â†’ è®¡åˆ’ä»»åŠ¡ï¼š

```bash
# æ·»åŠ æ•°æ®åº“å¤‡ä»½ä»»åŠ¡
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
mysqldump -u bimpms_user -pLkkWtYtjPrRiMKs8 bimpms > /backup/bimpms_$(date +\%Y\%m\%d).sql
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è®¿é—®åœ°å€

- **å‰ç«¯åœ°å€**ï¼šhttp://47.122.112.158
- **å®å¡”é¢æ¿**ï¼šhttp://47.122.112.158:8888
- **GitHubä»“åº“**ï¼šhttps://github.com/mms916/BIMPMS

### é»˜è®¤ç™»å½•è´¦å·

- **ç”¨æˆ·å**ï¼š`admin`
- **å¯†ç **ï¼š`123`

### ç›¸å…³æ–‡æ¡£

- äº§å“éœ€æ±‚æ–‡æ¡£ï¼š`docs/prd.md`
- APIæ–‡æ¡£ï¼š`docs/api.md`
- æ•°æ®åº“è®¾è®¡ï¼š`docs/database.md`

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é¡¹ï¼š

### ç³»ç»Ÿæ£€æŸ¥

- [ ] Node.jsç‰ˆæœ¬æ­£ç¡®ï¼ˆv20.11.1ï¼‰
- [ ] PM2æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] Nginxé…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“è¿æ¥æˆåŠŸ

### åŠŸèƒ½æ£€æŸ¥

- [ ] èƒ½å¤Ÿæ­£å¸¸ç™»å½•
- [ ] å·¥ä½œå°é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] é¡¹ç›®å°è´¦åŠŸèƒ½æ­£å¸¸
- [ ] å·¥ä½œåˆ†è§£åŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®èƒ½å¤Ÿæ­£å¸¸ä¿å­˜

### æ€§èƒ½æ£€æŸ¥

- [ ] é¡µé¢åŠ è½½é€Ÿåº¦æ­£å¸¸ï¼ˆ<3ç§’ï¼‰
- [ ] APIå“åº”æ—¶é—´æ­£å¸¸ï¼ˆ<500msï¼‰
- [ ] å†…å­˜ä½¿ç”¨æ­£å¸¸ï¼ˆ<1GBï¼‰
- [ ] CPUä½¿ç”¨æ­£å¸¸ï¼ˆ<50%ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2026-01-14
**ç»´æŠ¤è€…**ï¼šBIMé¡¹ç›®ç®¡ç†ç³»ç»Ÿå›¢é˜Ÿ
**é€‚ç”¨ç¯å¢ƒ**ï¼šå®å¡”é¢æ¿ + Alibaba Cloud Linux
